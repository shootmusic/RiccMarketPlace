<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Ricc Market</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">Ricc Market</div>
            <div class="nav-actions">
                <a href="/" class="btn-outline">Home</a>
                <a href="#" id="logoutBtn" class="btn-outline">Logout</a>
            </div>
        </div>
    </nav>

    <div class="dashboard">
        <div class="sidebar">
            <a href="#" onclick="showTab('home')" class="active">üè† Home</a>
            <a href="#" onclick="showTab('store')">üõí Toko Saya</a>
            <a href="#" onclick="showTab('products')">üì¶ Produk Saya</a>
            <a href="#" onclick="showTab('profile')">üë§ Profil</a>
        </div>
        
        <div class="content">
            <div id="home-tab">
                <h2>Semua Produk</h2>
                <div id="allProducts"></div>
            </div>
            <div id="store-tab" style="display:none">
                <h2>Toko Saya</h2>
                <div id="storeContent"></div>
            </div>
            <div id="products-tab" style="display:none">
                <h2>Produk Saya</h2>
                <div id="myProducts"></div>
            </div>
            <div id="profile-tab" style="display:none">
                <h2>Profil Saya</h2>
                <div id="profileContent"></div>
            </div>
        </div>
    </div>

    <script>
        let user = null;
        
        async function checkAuth() {
            const res = await fetch('/api/me');
            const data = await res.json();
            if (!data.user) window.location.href = '/login.html';
            user = data.user;
            loadAllProducts();
        }
        
        async function loadAllProducts() {
            const res = await fetch('/api/products');
            const products = await res.json();
            document.getElementById('allProducts').innerHTML = products.map(p => `
                <div class="product-card">
                    <h3>${p.title}</h3>
                    <p>${p.description.substring(0, 50)}...</p>
                    <div>Rp ${(p.price * 1000000).toLocaleString()}</div>
                    <button onclick="buyProduct('${p.id}')">Beli</button>
                </div>
            `).join('');
        }
        
        window.buyProduct = (id) => {
            alert('Fitur pembayaran menyusul');
        };
        
        window.showTab = (tab) => {
            document.querySelectorAll('.content > div').forEach(d => d.style.display = 'none');
            document.getElementById(`${tab}-tab`).style.display = 'block';
            document.querySelectorAll('.sidebar a').forEach(a => a.classList.remove('active'));
            event.target.classList.add('active');
        };
        
        document.getElementById('logoutBtn').onclick = async (e) => {
            e.preventDefault();
            await fetch('/api/logout', { method: 'POST' });
            window.location.href = '/';
        };
        
        checkAuth();
    </script>
</body>
</html>
